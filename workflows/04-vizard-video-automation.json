{
  "name": "Vizard AI - Video Automation",
  "nodes": [
    {
      "parameters": {
        "content": "## ğŸ¬ Workflow: Vizard AI Video Automation\n\n**Flujo completo:**\n1. Detecta nuevo video en Google Drive\n2. EnvÃ­a a Vizard.ai para procesamiento\n3. Vizard crea clips en mÃºltiples formatos:\n   - 9:16 para Instagram Reels y YouTube Shorts\n   - 16:9 para YouTube horizontal\n4. Webhook de Vizard notifica cuando estÃ¡ listo\n5. EnvÃ­a notificaciÃ³n a Telegram con preview\n6. Usuario aprueba/rechaza desde Telegram\n7. Si aprobado â†’ programa publicaciÃ³n\n\n**ConfiguraciÃ³n necesaria:**\n- API Key de Vizard.ai en: Workspace Settings > API\n- Telegram Bot Token (crear con @BotFather)\n- Google Drive credenciales\n- YouTube API credentials (para publicaciÃ³n)\n\n**Formatos generados:**\n- ratioOfClip: 1 (9:16) â†’ Reels & Shorts\n- ratioOfClip: 4 (16:9) â†’ YouTube\n\n**Opciones avanzadas:**\n- SubtÃ­tulos automÃ¡ticos\n- Remove silences\n- Auto B-roll\n- Emojis\n- Keywords para detectar temas especÃ­ficos",
        "height": 600,
        "width": 600
      },
      "id": "sticky-note-vizard",
      "name": "ğŸ“ Info del Workflow",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [240, -100]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "list",
        "folderToWatch": "",
        "event": "fileCreated",
        "options": {
          "fileType": "video"
        }
      },
      "id": "google-drive-trigger",
      "name": "ğŸ¥ Nuevo Video en Drive",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [460, 300],
      "webhookId": "google-drive-video-upload"
    },
    {
      "parameters": {
        "jsCode": "// Extraer informaciÃ³n del video subido a Google Drive\nconst file = $input.first().json;\n\n// Construir URL directa de Google Drive para Vizard\nconst fileId = file.id;\nconst driveUrl = `https://drive.google.com/file/d/${fileId}/view`;\n\nreturn {\n  json: {\n    videoName: file.name,\n    videoId: fileId,\n    videoUrl: driveUrl,\n    mimeType: file.mimeType,\n    size: file.size,\n    createdTime: file.createdTime\n  }\n};"
      },
      "id": "extract-video-info",
      "name": "ğŸ“‹ Extraer Info",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://elb-api.vizard.ai/hvizard-server-front/open-api/v1/project/create",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "VIZARDAI_API_KEY",
              "value": "378973e2b1604524bd4a2e25bce1c6fe"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"lang\": \"es\",\n  \"videoUrl\": \"{{ $json.videoUrl }}\",\n  \"videoType\": 3,\n  \"preferLength\": [2, 3],\n  \"ratioOfClip\": 1,\n  \"subtitleSwitch\": 1,\n  \"autoBrollSwitch\": 1,\n  \"removeSilenceSwitch\": 1,\n  \"emojiSwitch\": 1,\n  \"maxClipNumber\": 10\n}",
        "options": {}
      },
      "id": "submit-to-vizard",
      "name": "ğŸš€ Enviar a Vizard",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "jsCode": "// Guardar projectId para tracking\nconst response = $input.first().json;\nconst videoInfo = $('ğŸ“‹ Extraer Info').first().json;\n\nreturn {\n  json: {\n    projectId: response.projectId,\n    shareLink: response.shareLink,\n    videoName: videoInfo.videoName,\n    videoUrl: videoInfo.videoUrl,\n    status: 'processing',\n    submittedAt: new Date().toISOString()\n  }\n};"
      },
      "id": "save-project-id",
      "name": "ğŸ’¾ Guardar Project ID",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "vizard-webhook",
        "options": {
          "rawBody": true
        },
        "responseMode": "onReceived"
      },
      "id": "vizard-webhook",
      "name": "ğŸ”” Webhook Vizard",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [460, 600],
      "webhookId": "vizard-completion"
    },
    {
      "parameters": {
        "jsCode": "// Procesar notificaciÃ³n de Vizard cuando los clips estÃ¡n listos\nconst webhook = $input.first().json.body;\n\nreturn {\n  json: {\n    projectId: webhook.projectId,\n    status: webhook.status,\n    clipsReady: webhook.clipsReady || [],\n    processingTime: webhook.processingTime,\n    receivedAt: new Date().toISOString()\n  }\n};"
      },
      "id": "process-webhook",
      "name": "âš™ï¸ Procesar Webhook",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 600]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://elb-api.vizard.ai/hvizard-server-front/open-api/v1/project/query/{{ $json.projectId }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "VIZARDAI_API_KEY",
              "value": "378973e2b1604524bd4a2e25bce1c6fe"
            }
          ]
        },
        "options": {}
      },
      "id": "get-clips",
      "name": "ğŸ“¥ Obtener Clips",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [900, 600]
    },
    {
      "parameters": {
        "jsCode": "// Extraer URLs de los clips generados\nconst response = $input.first().json;\n\n// Vizard devuelve los clips en el array 'videos'\nconst data = response.data || response;\nconst videos = data.videos || [];\n\n// Procesar cada clip con la informaciÃ³n disponible\nconst clips = videos.map(v => ({\n  id: v.videoId || v.clipEditorId,\n  clipEditorId: v.clipEditorId,\n  videoId: v.videoId,\n  title: v.title,\n  viralScore: v.viralScore,\n  duration: v.videoDuration,\n  transcript: v.transcript,\n  viralReason: v.viralReason\n}));\n\nreturn {\n  json: {\n    projectId: data.projectId,\n    projectName: data.projectName,\n    shareLink: data.shareLink,\n    totalClips: clips.length,\n    clips: clips,\n    // Por ahora todos los clips juntos (el ratio se configurÃ³ al crear el proyecto)\n    verticalClips: clips,\n    horizontalClips: []\n  }\n};"
      },
      "id": "organize-clips",
      "name": "ğŸ“‚ Organizar Clips",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 600]
    },
    {
      "parameters": {
        "chatId": "124358563",
        "text": "=ğŸ¬ **Clips listos para revisar**\n\nğŸ“¹ Proyecto: {{ $json.projectName }}\nğŸ“Š Total de clips: {{ $json.totalClips }}\n\n**Verticales (9:16)** - Instagram Reels / YouTube Shorts:\n{{ $json.verticalClips.length }} clips\n\n**Horizontales (16:9)** - YouTube:\n{{ $json.horizontalClips.length }} clips\n\nğŸ‘‰ Revisa los clips y aprueba los que quieras publicar.",
        "additionalFields": {
          "replyMarkup": "inlineKeyboard",
          "inlineKeyboard": "={{ \n  {\n    \"inline_keyboard\": [\n      [\n        {\"text\": \"âœ… Aprobar todos\", \"callback_data\": \"approve_all_\" + $json.projectId},\n        {\"text\": \"âŒ Rechazar todos\", \"callback_data\": \"reject_all_\" + $json.projectId}\n      ],\n      [\n        {\"text\": \"ğŸ” Ver clips\", \"url\": \"https://app.vizard.ai/project/\" + $json.projectId}\n      ]\n    ]\n  }\n}}"
        }
      },
      "id": "send-telegram",
      "name": "ğŸ“± Notificar Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1340, 600]
    },
    {
      "parameters": {
        "updates": [
          "callback_query"
        ]
      },
      "id": "telegram-trigger",
      "name": "ğŸ“² Respuesta Telegram",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [460, 900],
      "webhookId": "telegram-approval"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.callback_query.data }}",
              "operation": "contains",
              "value2": "approve_all"
            }
          ]
        }
      },
      "id": "if-approved",
      "name": "âœ… Aprobado?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 900]
    },
    {
      "parameters": {
        "jsCode": "// Extraer projectId de callback_data\nconst callbackData = $input.first().json.callback_query.data;\nconst projectId = callbackData.split('_')[2];\n\nreturn {\n  json: {\n    projectId: projectId,\n    action: callbackData.includes('approve') ? 'approved' : 'rejected',\n    approvedAt: new Date().toISOString()\n  }\n};"
      },
      "id": "process-approval",
      "name": "âš™ï¸ Procesar AprobaciÃ³n",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 800]
    },
    {
      "parameters": {
        "content": "## ğŸ“… PublicaciÃ³n Programada\n\nDesde aquÃ­ puedes:\n1. Programar publicaciÃ³n en YouTube\n2. Guardar clips para publicaciÃ³n manual en Instagram\n3. Integrar con Buffer/Hootsuite para auto-publicaciÃ³n\n\n**PrÃ³ximos pasos:**\n- Configurar YouTube API\n- Integrar calendario de publicaciÃ³n\n- AÃ±adir generaciÃ³n de captions con IA",
        "height": 300,
        "width": 400
      },
      "id": "sticky-note-publish",
      "name": "ğŸ“ Nota: PublicaciÃ³n",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [1120, 800]
    },
    {
      "parameters": {
        "chatId": "={{ $json.callback_query.from.id }}",
        "text": "=âœ… Clips aprobados para publicaciÃ³n!\n\nSe programarÃ¡n automÃ¡ticamente en:\nğŸ“± Instagram Reels\nğŸ“º YouTube Shorts\nğŸ¬ YouTube (formato horizontal)\n\nRecibirÃ¡s confirmaciÃ³n cuando se publiquen.",
        "additionalFields": {}
      },
      "id": "confirm-telegram",
      "name": "âœ… Confirmar AprobaciÃ³n",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [900, 1000]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "OK",
        "options": {}
      },
      "id": "respond-webhook",
      "name": "âœ… Responder OK",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1340, 300]
    }
  ],
  "connections": {
    "ğŸ¥ Nuevo Video en Drive": {
      "main": [
        [
          {
            "node": "ğŸ“‹ Extraer Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ Extraer Info": {
      "main": [
        [
          {
            "node": "ğŸš€ Enviar a Vizard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸš€ Enviar a Vizard": {
      "main": [
        [
          {
            "node": "ğŸ’¾ Guardar Project ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ Guardar Project ID": {
      "main": [
        [
          {
            "node": "âœ… Responder OK",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”” Webhook Vizard": {
      "main": [
        [
          {
            "node": "âš™ï¸ Procesar Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš™ï¸ Procesar Webhook": {
      "main": [
        [
          {
            "node": "ğŸ“¥ Obtener Clips",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¥ Obtener Clips": {
      "main": [
        [
          {
            "node": "ğŸ“‚ Organizar Clips",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‚ Organizar Clips": {
      "main": [
        [
          {
            "node": "ğŸ“± Notificar Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“² Respuesta Telegram": {
      "main": [
        [
          {
            "node": "âœ… Aprobado?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœ… Aprobado?": {
      "main": [
        [
          {
            "node": "âš™ï¸ Procesar AprobaciÃ³n",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "âš™ï¸ Procesar AprobaciÃ³n": {
      "main": [
        [
          {
            "node": "âœ… Confirmar AprobaciÃ³n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "Vizard",
      "id": "vizard-1"
    },
    {
      "name": "Video",
      "id": "video-1"
    },
    {
      "name": "Automation",
      "id": "auto-2"
    }
  ],
  "meta": {
    "instanceId": "local"
  },
  "pinData": {},
  "versionId": "1"
}
