{
  "permissions": {
    "allow": [
      "Bash(chmod:*)",
      "Bash(docker exec:*)",
      "Bash(./setup-local.sh)",
      "Bash(ls:*)",
      "Bash(xargs:*)",
      "Bash(open http://localhost:5678)",
      "Bash(open:*)",
      "Bash(docker-compose restart:*)",
      "Bash(ssh:*)",
      "Bash(curl:*)",
      "Bash(docker logs:*)",
      "Bash(brew upgrade:*)",
      "Bash(brew install:*)",
      "Bash(softwareupdate --list:*)",
      "Bash(sudo rm:*)",
      "Bash(docker-compose:*)",
      "Bash(docker-compose up:*)",
      "Bash(grep:*)",
      "Bash(docker ps:*)",
      "Bash(pkill:*)",
      "Bash(cat:*)",
      "Bash(python3:*)",
      "WebSearch",
      "WebFetch(domain:docs.n8n.io)",
      "Bash(psql:*)",
      "Bash(pandoc:*)",
      "Bash(/usr/sbin/cupsfilter:*)",
      "Bash(\"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome\" --headless --disable-gpu --print-to-pdf=/tmp/camino_vital_arquitectura.pdf file:///tmp/camino_vital_arquitectura.html)",
      "Bash(tree:*)",
      "Bash(docker cp:*)",
      "Bash(docker restart:*)",
      "Bash(stripe --version:*)",
      "Bash(lsof:*)",
      "Bash(__NEW_LINE_dfa72cabc17f9995__ docker exec n8n_postgres psql -U n8n -d n8n -c \"\nUPDATE workflow_entity \nSET nodes = \\(SELECT pg_read_file\\(''/tmp/workflow_01bis_fixed.json''\\)::jsonb\\)\nWHERE id = ''j8LKtzkqviJXn32R'';\n\")",
      "Bash(__NEW_LINE_c52f502c630ee99b__ docker exec n8n_postgres psql -U n8n -d n8n -c \"\nUPDATE workflow_entity \nSET \n  nodes = \\(SELECT pg_read_file\\(''/tmp/nodes_01bis_fixed.json''\\)::jsonb\\),\n  connections = \\(SELECT pg_read_file\\(''/tmp/connections_01bis_fixed.json''\\)::jsonb\\)\nWHERE id = ''j8LKtzkqviJXn32R'';\n\")",
      "Bash(__NEW_LINE_2a20e23292c66215__ echo \"=== Probando workflow simplificado ===\")",
      "Bash(__NEW_LINE_774c647d10dbe3f9__ docker exec n8n_postgres psql -U n8n -d n8n -c \"\nUPDATE workflow_entity \nSET nodes = \\(SELECT pg_read_file\\(''/tmp/nodes_simple_fixed.json''\\)::jsonb\\)\nWHERE id = ''testSimple001'';\n\")",
      "Bash(__NEW_LINE_774c647d10dbe3f9__ docker restart n8n)",
      "Bash(__NEW_LINE_774c647d10dbe3f9__ echo \"=== Probando workflow con API key correcta ===\")",
      "Bash(__NEW_LINE_8fa2bd78835d1ea4__ docker exec n8n_postgres psql -U n8n -d n8n -c \"\nUPDATE workflow_entity \nSET nodes = \\(SELECT pg_read_file\\(''/tmp/nodes_ultra_simple.json''\\)::jsonb\\)\nWHERE id = ''testSimple001'';\n\")",
      "Bash(__NEW_LINE_8fa2bd78835d1ea4__ docker restart n8n)",
      "Bash(__NEW_LINE_8fa2bd78835d1ea4__ echo \"=== Probando workflow ultra-simplificado ===\")",
      "Bash(__NEW_LINE_a06612a8eb7445dd__ docker exec n8n_postgres psql -U n8n -d n8n -c \"\nUPDATE workflow_entity \nSET nodes = \\(SELECT pg_read_file\\(''/tmp/nodes_json_fixed.json''\\)::jsonb\\)\nWHERE id = ''testSimple001'';\n\")",
      "Bash(__NEW_LINE_a06612a8eb7445dd__ docker restart n8n)",
      "Bash(__NEW_LINE_a06612a8eb7445dd__ echo \"=== Probando workflow con JSON corregido ===\")",
      "Bash(__NEW_LINE_23ded1f956c76abd__ echo \"\")",
      "Bash(__NEW_LINE_c93d195706f3f572__ echo \"\")",
      "Bash(NEW_QUERY='=SELECT * FROM procesar_checkpoint_interactivo\\(\n  {{ $node[\"\"Webhook Checkpoint Semanal\"\"].json.query.user_id }}::INTEGER,\n  {{ $node[\"\"Webhook Checkpoint Semanal\"\"].json.query.sesiones }}::INTEGER,\n  '\"''\"'{{ $node[\"\"Analizar Semana Usuario\"\"].json.accion_nivel }}'\"''\"'::VARCHAR,\n  {{ $node[\"\"Analizar Semana Usuario\"\"].json.accion_intensidad }}::INTEGER,\n  '\"''\"'{{ $node[\"\"Analizar Semana Usuario\"\"].json.adherencia_nivel }}'\"''\"'::VARCHAR,\n  '\"''\"'{{ $node[\"\"Analizar Semana Usuario\"\"].json.feedback_mayoritario }}'\"''\"'::VARCHAR,\n  '\"''\"'{{ $node[\"\"Analizar Semana Usuario\"\"].json.explicacion_corta }}'\"''\"'::VARCHAR\n\\);')",
      "Bash(__NEW_LINE_f6f81a5a9e245ec9__ docker exec n8n_postgres psql -U n8n -d n8n -c \"\nUPDATE workflow_entity \nSET nodes = jsonb_set\\(\n  nodes::jsonb,\n  ''{2,parameters,query}'',\n  ''\"\"$NEW_QUERY\"\"''::jsonb\n\\),\n\"\"updatedAt\"\" = NOW\\(\\)\nWHERE name = ''Camino Vital - 07 Procesar Checkpoint Semanal''\nRETURNING name;\")",
      "Bash(API_KEY=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZDVlYTAwMC1kZDU0LTQxZDUtYTg4YS1lNGIxZWY3ZWI1M2UiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY4NDkwNDY0LCJleHAiOjE3NzEwMjM2MDB9.R9HtNJMcU5bQIY2-Uo-QrP40cHFA-2CMrb4YE9Dy75M\")",
      "Bash(WORKFLOW_FILE=\"/Users/albertvillanueva/Documents/HV_n8n/programa-camino-vital/workflows/[TEST-CV] 01 Onboarding.json\")",
      "Bash(__NEW_LINE_14cbfab9b914b5b9__ curl -s -X PUT -H \"X-N8N-API-KEY: $API_KEY\" -H \"Content-Type: application/json\" --data-binary \"@$WORKFLOW_FILE\" \"http://localhost:5678/api/v1/workflows/raqBLvnwiYzVRu0Z\")",
      "Bash(__NEW_LINE_1dd1172504491058__ curl -s -X PUT -H \"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZDVlYTAwMC1kZDU0LTQxZDUtYTg4YS1lNGIxZWY3ZWI1M2UiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY4NDkwNDY0LCJleHAiOjE3NzEwMjM2MDB9.R9HtNJMcU5bQIY2-Uo-QrP40cHFA-2CMrb4YE9Dy75M\" -H \"Content-Type: application/json\" --data-binary @/tmp/workflow_clean2.json \"http://localhost:5678/api/v1/workflows/raqBLvnwiYzVRu0Z\")",
      "Bash(jq '{ name, nodes: [.nodes[] | {parameters, id, name, type, typeVersion, position} + \\(if .credentials then {credentials} else {} end\\) + \\(if .webhookId then {webhookId} else {} end\\)], connections, settings }' /tmp/workflow_update.json curl -s -X PUT -H \"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZDVlYTAwMC1kZDU0LTQxZDUtYTg4YS1lNGIxZWY3ZWI1M2UiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY4NDkwNDY0LCJleHAiOjE3NzEwMjM2MDB9.R9HtNJMcU5bQIY2-Uo-QrP40cHFA-2CMrb4YE9Dy75M\" -H \"Content-Type: application/json\" --data-binary @/tmp/workflow_clean3.json \"http://localhost:5678/api/v1/workflows/raqBLvnwiYzVRu0Z\")",
      "Bash(jq '{ name, nodes: [.nodes[] | {parameters, id, name, type, typeVersion, position} + \\(if .credentials then {credentials} else {} end\\) + \\(if .webhookId then {webhookId} else {} end\\) + \\(if .onError then {onError} else {} end\\)], connections, settings }' \"/Users/albertvillanueva/Documents/HV_n8n/programa-camino-vital/workflows/Camino Vital - 01-bis Seleccionar Sesiones y Enviar Primera.json\" curl -s -X PUT -H \"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZDVlYTAwMC1kZDU0LTQxZDUtYTg4YS1lNGIxZWY3ZWI1M2UiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY4NDkwNDY0LCJleHAiOjE3NzEwMjM2MDB9.R9HtNJMcU5bQIY2-Uo-QrP40cHFA-2CMrb4YE9Dy75M\" -H \"Content-Type: application/json\" --data-binary @/tmp/workflow_01bis.json \"http://localhost:5678/api/v1/workflows/j8LKtzkqviJXn32R\")",
      "Bash(# Limpiar y actualizar jq ''{ name, nodes: [.nodes[] | {parameters, id, name, type, typeVersion, position} + \\(if .credentials then {credentials} else {} end\\) + \\(if .webhookId then {webhookId} else {} end\\)], connections, settings }'' /tmp/workflow_guardar_lead_fixed.json curl -s -X PUT -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZDVlYTAwMC1kZDU0LTQxZDUtYTg4YS1lNGIxZWY3ZWI1M2UiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY4NDkwNDY0LCJleHAiOjE3NzEwMjM2MDB9.R9HtNJMcU5bQIY2-Uo-QrP40cHFA-2CMrb4YE9Dy75M\"\" -H \"\"Content-Type: application/json\"\" --data-binary @/tmp/workflow_guardar_lead_clean.json \"\"http://localhost:5678/api/v1/workflows/4ec1HJCYzwIeFWAr\"\")",
      "Bash(# Limpiar y actualizar jq ''{ name, nodes: [.nodes[] | {parameters, id, name, type, typeVersion, position} + \\(if .credentials then {credentials} else {} end\\) + \\(if .webhookId then {webhookId} else {} end\\)], connections, settings }'' /tmp/guardar_lead_fixed.json curl -s -X PUT -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZDVlYTAwMC1kZDU0LTQxZDUtYTg4YS1lNGIxZWY3ZWI1M2UiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY4NDkwNDY0LCJleHAiOjE3NzEwMjM2MDB9.R9HtNJMcU5bQIY2-Uo-QrP40cHFA-2CMrb4YE9Dy75M\"\" -H \"\"Content-Type: application/json\"\" --data-binary @/tmp/guardar_lead_clean.json \"\"http://localhost:5678/api/v1/workflows/4ec1HJCYzwIeFWAr\"\")",
      "Bash(# Limpiar y subir jq ''{ name, nodes: [.nodes[] | {parameters, id, name, type, typeVersion, position} + \\(if .credentials then {credentials} else {} end\\)], connections, settings }'' /tmp/checkpoint_fixed.json curl -s -X PUT -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZDVlYTAwMC1kZDU0LTQxZDUtYTg4YS1lNGIxZWY3ZWI1M2UiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY4NDkwNDY0LCJleHAiOjE3NzEwMjM2MDB9.R9HtNJMcU5bQIY2-Uo-QrP40cHFA-2CMrb4YE9Dy75M\"\" -H \"\"Content-Type: application/json\"\" --data-binary @/tmp/checkpoint_clean.json \"\"http://localhost:5678/api/v1/workflows/RqWiWcHfzRz8Ep5w\"\")",
      "Bash(# Limpiar y subir workflow 06 jq ''{ name, nodes: [.nodes[] | {parameters, id, name, type, typeVersion, position} + \\(if .credentials then {credentials} else {} end\\)], connections, settings }'' /tmp/checkpoint_fixed.json curl -s -X PUT -H \"\"X-N8N-API-KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZDVlYTAwMC1kZDU0LTQxZDUtYTg4YS1lNGIxZWY3ZWI1M2UiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY4NDkwNDY0LCJleHAiOjE3NzEwMjM2MDB9.R9HtNJMcU5bQIY2-Uo-QrP40cHFA-2CMrb4YE9Dy75M\"\" -H \"\"Content-Type: application/json\"\" --data-binary @/tmp/checkpoint_clean.json \"\"http://localhost:5678/api/v1/workflows/RqWiWcHfzRz8Ep5w\"\")",
      "Bash(__NEW_LINE_22e10375578dad76__ echo \"Workflow descargado\")",
      "Bash(API_KEY=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0ZDVlYTAwMC1kZDU0LTQxZDUtYTg4YS1lNGIxZWY3ZWI1M2UiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzY4NTY2ODcwLCJleHAiOjE3NzExMTAwMDB9.8OhA17QhAuNtvI0jufpD7VXSQo2GP45y-dwMY2w-5QM\")",
      "WebFetch(domain:habitos-vitales.com)",
      "Bash(done)",
      "Bash(docker compose exec:*)",
      "Bash(docker compose:*)",
      "Bash(find:*)",
      "Bash(1 <<'EOF'\nSET search_path TO public;\n\nWITH usuario_actual AS \\(\n  SELECT \n    id, email, nombre, etapa,\n    nivel_actual, intensidad_nivel,\n    semana_actual,\n    sesiones_completadas_semana, sesiones_objetivo_semana,\n    volumen_extra,\n    ajustado_esta_semana,\n    COALESCE\\(ajustado_esta_semana, FALSE\\) as ya_procesado\n  FROM programa_users\n  WHERE id = 12\n\\)\nSELECT * FROM usuario_actual;\nEOF)",
      "Bash(brew list:*)",
      "Bash(for i in {1..12})",
      "Bash(do sleep 5)",
      "Bash(__NEW_LINE_cc11254b10faeeaa__ docker exec n8n_postgres psql -U n8n -d n8n -c \"SELECT sesiones_completadas_semana as completadas, sesion_actual_dentro_semana as actual FROM programa_users WHERE id = 19;\")",
      "Bash(__NEW_LINE_6fb023dddde554c4__ docker exec n8n_postgres psql -U n8n -d n8n -c \"SELECT sesiones_completadas_semana as completadas, sesion_actual_dentro_semana as actual FROM programa_users WHERE id = 19;\")",
      "Bash(__NEW_LINE_be19912dd7038333__ echo \"=== PROBANDO FEEDBACK SESIÃ“N 1 ===\")",
      "Bash(__NEW_LINE_440bb6107680dd1a__ sleep 20)",
      "Bash(__NEW_LINE_440bb6107680dd1a__ echo \"\")",
      "Bash(else)",
      "Bash(echo:*)",
      "Bash(fi)",
      "Bash(docker stop:*)",
      "Bash(docker start:*)",
      "Bash(API_KEY=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxZjkyZDI2ZC0wYjc4LTQwMGItODg4Ny05N2E3OTQzMzY5YjIiLCJpc3MiOiJuOG4iLCJhdWQiOiJwdWJsaWMtYXBpIiwiaWF0IjoxNzM1NzMzODc1fQ.YFoaMYdPWkhMH-iiJpex6lE8_UKsFvLZU8d_P18LMmI\")",
      "Bash(__NEW_LINE_4832dc6d8fe18c2a__ sleep 5)",
      "Bash(__NEW_LINE_4832dc6d8fe18c2a__ echo -e \"\\\\n\\\\nEstado despuÃ©s del checkpoint:\")",
      "Bash(# Buscar archivos de workflow en el proyecto find /Users/albertvillanueva/Documents/HV_n8n -name \"\"*.json\"\" -type f | xargs grep -l \"\"Procesar Checkpoint\"\")",
      "Bash(# Intentar de nuevo con permisos correctos cat \"\"/Users/albertvillanueva/Documents/HV_n8n/programa-camino-vital/workflows/07-procesar-checkpoint-semanal.json\"\" docker cp /tmp/wf07-restore.json n8n:/tmp/wf07-restore.json docker exec n8n chmod 644 /tmp/wf07-restore.json docker exec n8n n8n import:workflow --input=/tmp/wf07-restore.json 2>&1)",
      "Bash(jq:*)",
      "Bash(while read wf)",
      "Bash(do echo \"=== $wf ===\")",
      "Bash(Actualizar.*Usuario\"; \"i\"\\)\\) | .name\")",
      "Bash(__NEW_LINE_285c34266261ecfd__ echo \"\")",
      "Bash(__NEW_LINE_ea4b99625f91705f__ echo \"\")",
      "Bash(__NEW_LINE_ee5c505d3df41e86__ echo \"\")",
      "Bash(# Get the full node and fix it properly docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" # Use jq to modify the query in the Registrar Feedback node cat /tmp/wf03bis_nodes.json)",
      "Bash(1 cat /tmp/wf03bis_nodes_fixed.json)",
      "Bash(# Fix sed on macOS - use temp file sed \"\"s/''completa_facil'', ''completa_bien'', ''completa_dificil''/''completa_facil'', ''completa_bien'', ''completa_normal'', ''completa_dificil''/g\"\" /tmp/wf03bis_fixed.json # Verify echo \"\"=== Verificando completitud fix ===\"\" grep -o \"\"''completa_facil''.*''completa_dificil''\"\" /tmp/wf03bis_fixed2.json)",
      "Bash(# Verify the complete fix docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" | jq -r ''.[] | select\\(.name == \"\"Registrar Feedback\"\"\\) | .parameters.query'')",
      "Bash(# Check the exact string that needs to be replaced docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" | jq -r ''.[] | select\\(.name == \"\"Registrar Feedback\"\"\\) | .parameters.query'')",
      "Bash(# Add completa_normal case - using the exact pattern docker exec n8n_postgres psql -U n8n -d n8n -c \"\" UPDATE workflow_entity SET nodes = replace\\( nodes::text, E''WHEN ''''{{ \\\\$node[\\\\\"\"Webhook SesiÃ³n Completada\\\\\"\"].json.query.feedback }}'''' = ''''completa_bien'''' THEN ''''apropiado''''\\\\n WHEN ''''{{ \\\\$node[\\\\\"\"Webhook SesiÃ³n Completada\\\\\"\"].json.query.feedback }}'''' = ''''completa_dificil'''' THEN ''''dificil'''''', E''WHEN ''''{{ \\\\$node[\\\\\"\"Webhook SesiÃ³n Completada\\\\\"\"].json.query.feedback }}'''' = ''''completa_bien'''' THEN ''''apropiado''''\\\\n WHEN ''''{{ \\\\$node[\\\\\"\"Webhook SesiÃ³n Completada\\\\\"\"].json.query.feedback }}'''' = ''''completa_normal'''' THEN ''''normal''''\\\\n WHEN ''''{{ \\\\$node[\\\\\"\"Webhook SesiÃ³n Completada\\\\\"\"].json.query.feedback }}'''' = ''''completa_dificil'''' THEN ''''dificil'''''' \\)::json WHERE id = ''uQ0KqwaII78YdFSa''; \"\" # Verify docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" | jq -r ''.[] | select\\(.name == \"\"Registrar Feedback\"\"\\) | .parameters.query'')",
      "Bash(# Check current state of the respuesta CASE docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" | jq -r ''.[] | select\\(.name == \"\"Registrar Feedback\"\"\\) | .parameters.query'')",
      "Bash(# Check lines BEFORE \"\"as respuesta\"\" docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" | jq -r ''.[] | select\\(.name == \"\"Registrar Feedback\"\"\\) | .parameters.query'')",
      "Bash(# Try replacing just the single line pattern - insert after completa_bien line docker exec n8n_postgres psql -U n8n -d n8n -c \"\" UPDATE workflow_entity SET nodes = replace\\( nodes::text, ''''''completa_bien'''' THEN ''''apropiado'''''', ''''''completa_bien'''' THEN ''''apropiado'''' WHEN ''''{{ \\\\$node[\\\\\"\"Webhook SesiÃ³n Completada\\\\\"\"].json.query.feedback }}'''' = ''''completa_normal'''' THEN ''''normal'''''' \\)::json WHERE id = ''uQ0KqwaII78YdFSa''; \"\" # Verify docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" | jq -r ''.[] | select\\(.name == \"\"Registrar Feedback\"\"\\) | .parameters.query'')",
      "Bash(# Use \\\\\\\\n for JSON newline docker exec n8n_postgres psql -U n8n -d n8n -c \"\" UPDATE workflow_entity SET nodes = replace\\( nodes::text, ''''''completa_bien'''' THEN ''''apropiado'''''', ''''''completa_bien'''' THEN ''''apropiado''''\\\\\\\\n WHEN ''''{{ \\\\$node[\\\\\"\"Webhook SesiÃ³n Completada\\\\\"\"].json.query.feedback }}'''' = ''''completa_normal'''' THEN ''''normal'''''' \\)::json WHERE id = ''uQ0KqwaII78YdFSa''; \"\" # Verify docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" | jq -r ''.[] | select\\(.name == \"\"Registrar Feedback\"\"\\) | .parameters.query'')",
      "Bash(# Escape $ and use proper JSON escaping docker exec n8n_postgres psql -U n8n -d n8n -c \"\" UPDATE workflow_entity SET nodes = replace\\( nodes::text, ''''''completa_bien'''' THEN ''''apropiado'''''', ''''''completa_bien'''' THEN ''''apropiado''''\\\\\\\\n WHEN ''''{{ \\\\\\\\\\\\$node[\\\\\\\\\\\\\"\"Webhook SesiÃ³n Completada\\\\\\\\\\\\\"\"].json.query.feedback }}'''' = ''''completa_normal'''' THEN ''''normal'''''' \\)::json WHERE id = ''uQ0KqwaII78YdFSa''; \"\" # Verify docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" | jq -r ''.[] | select\\(.name == \"\"Registrar Feedback\"\"\\) | .parameters.query'')",
      "Bash(# Verify the fix is applied in the database docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE id = ''uQ0KqwaII78YdFSa''; \"\" | jq -r ''.[] | select\\(.name == \"\"Registrar Feedback\"\"\\) | .parameters.query'')",
      "Bash(__NEW_LINE_aefb27d8edc2a875__ echo \"\")",
      "Bash(__NEW_LINE_21c811bee81b8e56__ echo \"\")",
      "Bash(__NEW_LINE_af366fb06a583880__ docker exec n8n_postgres psql -U n8n -d n8n -c \"\nSELECT ''â•â•â• USUARIO â•â•â•'' as info;\nSELECT id, email, nombre, estado, semana_actual, nivel_actual, \n       intensidad_nivel as intensidad, sesiones_objetivo_semana as objetivo,\n       sesiones_completadas_semana as completadas\nFROM programa_users WHERE id = 27;\n\nSELECT ''â•â•â• FEEDBACK \\(todas las sesiones\\) â•â•â•'' as info;\nSELECT semana, sesion_numero, respuesta, completitud, accion_tomada\nFROM programa_feedback WHERE user_id = 27 ORDER BY semana, sesion_numero;\n\nSELECT ''â•â•â• SESIONES GENERADAS â•â•â•'' as info;\nSELECT semana, numero_sesion, LEFT\\(titulo, 45\\) as titulo, completada,\n       CASE WHEN generada_por = ''claude-ia'' THEN ''ðŸ¤– IA'' ELSE generada_por END as generador\nFROM programa_sesiones WHERE user_id = 27 ORDER BY semana, numero_sesion;\n\nSELECT ''â•â•â• EMAILS ENVIADOS â•â•â•'' as info;\nSELECT e.id, e.sesion_id, s.titulo, e.estado, e.fecha_envio::timestamp\\(0\\) as enviado\nFROM programa_envios e\nLEFT JOIN programa_sesiones s ON e.sesion_id = s.id\nWHERE e.user_id = 27 ORDER BY e.fecha_envio;\n\")",
      "Bash(# Buscar el workflow de onboarding y ver cÃ³mo se crea el usuario docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE name LIKE ''%Onboarding%'' OR name LIKE ''%01%''; \"\" | jq ''.[] | select\\(.name | test\\(\"\"Crear|Insert|Usuario\"\"; \"\"i\"\"\\)\\) | {name, query: .parameters.query}'')",
      "Bash(# Verificar workflow 01-bis que es donde se seleccionan las sesiones docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE name LIKE ''%01-bis%''; \"\" | jq ''.[] | select\\(.parameters.query != null\\) | {name, query: .parameters.query}'')",
      "Bash(# Verificar que el cambio se aplicÃ³ docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE name LIKE ''%07%Procesar%Checkpoint%''; \"\" | jq -r ''.[] | select\\(.name == \"\"Procesar Checkpoint\"\"\\) | .parameters.query'')",
      "Bash(__NEW_LINE_e9e7c75f33ab725c__ echo \"\")",
      "Bash(# Ver cÃ³mo se preparan los emails de sesiÃ³n en los diferentes workflows # Workflow 01-bis \\(primera sesiÃ³n\\) echo \"\"=== WORKFLOW 01-bis \\(Preparar Email SesiÃ³n\\) ===\"\" docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE name LIKE ''%01-bis%''; \"\" | jq -r ''.[] | select\\(.name | test\\(\"\"Preparar Email\"\"\\)\\) | .parameters.jsCode'')",
      "Bash(__NEW_LINE_232255546128aa8d__ echo \"\")",
      "Bash(__NEW_LINE_a4115c05f9d21fbd__ echo \"\")",
      "Bash(# Verificar que todos los emails muestran \"\"X de Y\"\" echo \"\"=== 01-bis \\(Header\\) ===\"\" docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE name LIKE ''%01-bis%''; \"\" | jq -r ''.[] | select\\(.name | test\\(\"\"Preparar Email\"\"\\)\\) | .parameters.jsCode'')",
      "Bash(# Ver cÃ³mo el workflow 07 maneja los banners de ajuste docker exec n8n_postgres psql -U n8n -d n8n -t -c \"\" SELECT nodes FROM workflow_entity WHERE name LIKE ''%07%Procesar%''; \"\" | jq -r ''.[] | select\\(.name == \"\"Preparar Email SesiÃ³n\"\"\\) | .parameters.jsCode'')",
      "Bash(for wf in \"Camino Vital - 01-bis Seleccionar Sesiones y Enviar Primera\" \"Camino Vital - 06 Checkpoint Dominical\" \"Camino Vital - 07 Procesar Checkpoint Semanal\" \"Camino Vital - 09 Mostrar SesiÃ³n\")",
      "Bash(do echo \"=== $wf ===\" docker exec n8n_postgres psql -U n8n -d n8n -t -c \"SELECT nodes FROM workflow_entity WHERE name = ''$wf'';\")",
      "Bash(for wf in \"Camino Vital - 01-bis Seleccionar Sesiones y Enviar Primera\" \"Camino Vital - 03-bis Feedback y Siguiente SesiÃ³n\" \"Camino Vital - 07 Procesar Checkpoint Semanal\")",
      "Bash(# Restore workflow 07 jq ''.nodes'' \"\"/Users/albertvillanueva/Documents/HV_n8n/programa-camino-vital/workflows/Camino Vital - 07 Procesar Checkpoint Semanal.json\"\" 2>&1 jq ''.connections'' \"\"/Users/albertvillanueva/Documents/HV_n8n/programa-camino-vital/workflows/Camino Vital - 07 Procesar Checkpoint Semanal.json\"\" 2>&1 jq -c ''.'' /tmp/restore_07_nodes.json)",
      "Bash(# Restore from data folder version jq ''.nodes'' \"\"/Users/albertvillanueva/Documents/HV_n8n/data/n8n/workflow-07.json\"\" 2>&1 jq ''.connections'' \"\"/Users/albertvillanueva/Documents/HV_n8n/data/n8n/workflow-07.json\"\" 2>&1 jq -c ''.'' /tmp/restore_07_v2_nodes.json)",
      "Bash(git add:*)"
    ],
    "deny": [],
    "ask": []
  }
}
